!function(r,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("crypto")):"function"==typeof define&&define.amd?define(["crypto"],t):r.chat=t(r.crypto)}(this,function(r){"use strict";r=r&&r.hasOwnProperty("default")?r.default:r;var t=function(r){return null!=r&&"object"==typeof r&&!1===Array.isArray(r)};function n(r){return!0===t(r)&&"[object Object]"===Object.prototype.toString.call(r)}for(var e=function(r){var t,e;return!1!==n(r)&&("function"==typeof(t=r.constructor)&&(!1!==n(e=t.prototype)&&!1!==e.hasOwnProperty("isPrototypeOf")))},o=function(){return r.randomBytes(16)},i=[],u=0;u<256;++u)i[u]=(u+256).toString(16).substr(1);var c=function(r,t){var n=t||0,e=i;return e[r[n++]]+e[r[n++]]+e[r[n++]]+e[r[n++]]+"-"+e[r[n++]]+e[r[n++]]+"-"+e[r[n++]]+e[r[n++]]+"-"+e[r[n++]]+e[r[n++]]+"-"+e[r[n++]]+e[r[n++]]+e[r[n++]]+e[r[n++]]+e[r[n++]]+e[r[n++]]};var a=function(r,t,n){var e=t&&n||0;"string"==typeof r&&(t="binary"===r?new Array(16):null,r=null);var i=(r=r||{}).random||(r.rng||o)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t)for(var u=0;u<16;++u)t[e+u]=i[u];return t||c(i)},f={ncp:"1.0.0",timeout:1e4},l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},s=function(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")},y=function(){function r(r,t){for(var n=0;n<t.length;n++){var e=t[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(r,e.key,e)}}return function(t,n,e){return n&&r(t.prototype,n),e&&r(t,e),t}}(),p=Object.assign||function(r){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(r[e]=n[e])}return r};function v(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],n=void 0;return"string"==typeof n&&(n=t.split(/ +/)),n.reduce(function(t,n){return null==r[n]?t:(t[n]=r[n],t)},{})}var d=new Map;function h(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=r.id,n=void 0===t?"":t,o=d.get(n);if(!n||!o)throw new Error("receive packet error");(function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e(r.result)&&!r.error})(r)?o.resolve(r):o.reject(r),d.delete(n)}var b={invoke:function(r){return function(r,t){var n=this,e=new Promise(function(o,i){var u=function(r){i(r),n.handleGlobalError(r)};e.resolve=o,e.reject=u,"Promise"!==Object.toString.call(r)?d.set(t.id,e):r.then(function(r){o(r)}).catch(function(r){u(r)})});return setTimeout(function(){d.delete(t.id),e.reject(new Error("timeout error"))},t.timeout),e}(global.__napos__sendToBrowser__(r),r)},onError:function(r){this.handleGlobalError=r},handleGlobalError:function(){}};return function(){function r(t){if(s(this,r),"object"===l(r.instance)&&r.instance instanceof r)return r.instance;Object.defineProperty(r,"instance",{value:this,configurable:!1,writable:!1}),this.init(),this.config(t),this.request=Object.create(b)}return y(r,[{key:"init",value:function(){if("function"!=typeof global.__napos__sendToBrowser__)throw new Error("runtime error");global.__napos__sendToJavascript__=h}},{key:"config",value:function(r){if(!e(r))throw new Error("config error");this._config=r}},{key:"invoke",value:function(){for(var r=arguments.length,t=Array(r),n=0;n<r;n++)t[n]=arguments[n];return this.request.invoke(function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return p({},v(r),v(e),{id:a(),params:n,method:t})}.apply(void 0,[this._config].concat(t)))}},{key:"onError",value:function(r){this.request.onError(r)}}]),r}()});
